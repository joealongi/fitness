<main
  style="
    min-height: 100vh;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    padding: 1rem;
  "
>
  <div class="container">
    <!-- Authentication Section -->
    @if (!(isAuthenticated$ | async)) {
    <div class="auth-section" style="margin-bottom: 2rem">
      <div class="grid grid-cols-2" style="max-width: 800px; margin: 0 auto">
        <!-- Login Form -->
        <div class="card" style="padding: 1.5rem">
          <h2
            style="
              font-size: 1.5rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 1.5rem;
              text-align: center;
            "
          >
            Login
          </h2>

          <form (ngSubmit)="login()" style="display: flex; flex-direction: column; gap: 1rem">
            <div>
              <label class="label" for="login-username">Username</label>
              <input
                type="text"
                [(ngModel)]="loginData.username"
                name="username"
                id="login-username"
                class="input"
                required
              />
            </div>

            <div>
              <label class="label" for="login-password">Password</label>
              <input
                type="password"
                [(ngModel)]="loginData.password"
                name="password"
                id="login-password"
                class="input"
                required
              />
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%">
              {{ loginLoading ? 'Logging in...' : 'Login' }}
            </button>
          </form>

          @if (loginError) {
          <div
            style="
              color: var(--error-color);
              font-size: 0.875rem;
              margin-top: 1rem;
              text-align: center;
            "
          >
            {{ loginError }}
          </div>
          }
        </div>

        <!-- Register Form -->
        <div class="card" style="padding: 1.5rem">
          <h2
            style="
              font-size: 1.5rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 1.5rem;
              text-align: center;
            "
          >
            Register
          </h2>

          <form (ngSubmit)="register()" style="display: flex; flex-direction: column; gap: 1rem">
            <div>
              <label class="label" for="register-username">Username</label>
              <input
                type="text"
                [(ngModel)]="registerData.username"
                name="username"
                id="register-username"
                class="input"
                required
              />
            </div>

            <div>
              <label class="label" for="register-email">Email</label>
              <input
                type="email"
                [(ngModel)]="registerData.email"
                name="email"
                id="register-email"
                class="input"
                required
              />
            </div>

            <div>
              <label class="label" for="register-password">Password</label>
              <input
                type="password"
                [(ngModel)]="registerData.password"
                name="password"
                id="register-password"
                class="input"
                required
              />
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%">
              {{ registerLoading ? 'Registering...' : 'Register' }}
            </button>
          </form>

          @if (registerError) {
          <div
            style="
              color: var(--error-color);
              font-size: 0.875rem;
              margin-top: 1rem;
              text-align: center;
            "
          >
            {{ registerError }}
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Demo Calculator Section for Unauthenticated Users -->
    <div style="margin-bottom: 2rem">
      <div class="card" style="padding: 1.5rem">
        <h2
          style="
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
          "
        >
          üßÆ Try Our VO2 Max Calculator
        </h2>

        <!-- Demo Badge -->
        <div
          style="
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            border: 1px solid #f59e0b;
            text-align: center;
            margin-bottom: 1rem;
          "
        >
          <span style="color: #92400e; font-weight: 600; font-size: 0.875rem">
            üéØ Free Demo - No Account Required
          </span>
        </div>

        <form
          (ngSubmit)="calculateDemoVO2Max()"
          style="display: flex; flex-direction: column; gap: 1rem"
        >
          <!-- Activity Type -->
          <div>
            <label class="label" for="demo_activity_type">Activity Type</label>
            <select
              [(ngModel)]="demoWorkout.activity_type"
              name="activity_type"
              id="demo_activity_type"
              class="select"
            >
              <option value="run">üèÉ Run</option>
              <option value="cycle">üö¥ Cycle</option>
              <option value="walk">üö∂ Walk</option>
            </select>
          </div>

          <!-- Duration -->
          <div>
            <label class="label" for="demo_duration">Duration (minutes)</label>
            <input
              type="number"
              [(ngModel)]="demoWorkout.duration"
              name="duration"
              id="demo_duration"
              required
              class="input"
              placeholder="30"
            />
          </div>

          <!-- Distance -->
          <div>
            <label class="label" for="demo_distance">Distance (km)</label>
            <input
              type="number"
              step="0.1"
              [(ngModel)]="demoWorkout.distance"
              name="distance"
              id="demo_distance"
              class="input"
              placeholder="5.0"
            />
          </div>

          <!-- Calculate Button -->
          <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.75rem 1rem">
            üßÆ Calculate VO2 Max (Demo)
          </button>
        </form>

        <!-- Demo Results (show results from demo calculator) -->
        @if (workoutResult && workoutResult.method === 'demo_calculator') {
        <div
          style="
            margin-top: 1rem;
            padding: 1rem;
            background: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
          "
        >
          <h4
            style="
              color: var(--text-primary);
              margin-bottom: 0.5rem;
              font-size: 1rem;
              text-align: center;
            "
          >
            üìä Your Demo Results
          </h4>

          @if (workoutResult.error) {
          <div style="color: var(--error-color); font-size: 0.875rem; text-align: center">
            ‚ö†Ô∏è {{ workoutResult.error }}
          </div>
          } @else {
          <div style="display: flex; flex-direction: column; gap: 1rem">
            <div
              style="
                background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
                padding: 1rem;
                border-radius: var(--border-radius);
                border: 1px solid #bfdbfe;
                text-align: center;
              "
            >
              <div
                style="
                  font-size: 0.875rem;
                  color: var(--primary-color);
                  font-weight: 500;
                  margin-bottom: 0.25rem;
                "
              >
                Estimated VO2 Max
              </div>
              <div style="font-size: 1.875rem; font-weight: 700; color: #1e40af">
                {{
                  workoutResult.vo2max_estimate
                    ? (workoutResult.vo2max_estimate | number : '1.1-1')
                    : 'N/A'
                }}
                <span style="font-size: 1.125rem; color: var(--primary-color)">mL/kg/min</span>
              </div>
            </div>

            <div
              style="
                background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
                padding: 1rem;
                border-radius: var(--border-radius);
                border: 1px solid #bbf7d0;
              "
            >
              <div
                style="
                  font-size: 0.875rem;
                  color: var(--success-color);
                  font-weight: 500;
                  margin-bottom: 0.5rem;
                "
              >
                Health Benefits
              </div>
              <div style="color: #166534; font-size: 0.875rem; line-height: 1.4">
                {{ workoutResult.benefits }}
              </div>
            </div>

            <div style="text-align: center">
              <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem">
                üí° <strong>{{ workoutResult.note }}</strong>
              </p>
            </div>
          </div>
          }
        </div>
        }

        <!-- System Status (visible to everyone) -->
        <div style="margin-top: 1rem">
          <div class="card" style="padding: 1rem">
            <h4
              style="
                font-size: 1rem;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <span style="margin-right: 0.5rem">üîó</span>
              System Status
            </h4>

            <div style="display: flex; flex-direction: column; gap: 0.5rem">
              <div
                class="status-indicator"
                [ngClass]="healthData ? 'status-success' : 'status-error'"
              >
                <div class="status-dot" [ngClass]="healthData ? 'success' : 'error'"></div>
                <span>{{
                  healthData ? 'Backend API - Connected' : 'Backend API - Disconnected'
                }}</span>
              </div>

              <div
                class="status-indicator"
                [ngClass]="norseData ? 'status-connected' : 'status-error'"
              >
                <div class="status-dot" [ngClass]="norseData ? 'connected' : 'error'"></div>
                <span>{{ norseData ? 'Norse SNN - Active' : 'Norse SNN - Inactive' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Call to Action -->
        <div
          style="
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid #10b981;
            text-align: center;
            margin-top: 1rem;
          "
        >
          <h4 style="color: var(--text-primary); margin-bottom: 0.5rem; font-size: 1rem">
            üíé Ready for More?
          </h4>
          <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem">
            Sign up to save workouts, access premium AI features, and get personalized insights.
          </p>
          <div style="display: flex; gap: 0.5rem">
            <button
              (click)="scrollToAuth()"
              class="btn btn-primary"
              style="flex: 1; font-size: 0.875rem"
            >
              Sign Up Free
            </button>
            <button
              (click)="scrollToAuth()"
              class="btn btn-secondary"
              style="flex: 1; font-size: 0.875rem"
            >
              Login
            </button>
          </div>
        </div>
      </div>
    </div>
    } @else {
    <!-- User Dashboard -->
    <div class="user-dashboard" style="margin-bottom: 2rem">
      <div class="card" style="padding: 1.5rem; text-align: center">
        <div style="display: flex; justify-content: space-between; align-items: center">
          <div>
            <h2
              style="
                font-size: 1.25rem;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 0.25rem;
              "
            >
              Welcome, {{ (currentUser$ | async)?.username }}!
            </h2>
            <p style="color: var(--text-secondary); font-size: 0.875rem">
              {{ (currentUser$ | async)?.email }}
            </p>
          </div>
          <button (click)="logout()" class="btn btn-secondary">Logout</button>
        </div>
      </div>
    </div>

    <!-- Header -->
    <div style="text-align: center; margin-bottom: 2rem">
      <h1
        style="
          font-size: 2.5rem;
          font-weight: 700;
          color: var(--text-primary);
          margin-bottom: 0.5rem;
        "
      >
        {{ title() }}
      </h1>
      <p style="font-size: 1.125rem; color: var(--text-secondary)">
        Log your workout to estimate VO2 max and learn its benefits.
      </p>
      <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem">
        üí° <strong>Tip:</strong> Create an account to save your workouts and access premium
        features!
      </p>
    </div>

    <div class="grid grid-cols-2">
      <!-- Workout Form -->
      <div class="card" style="padding: 1.5rem; margin-bottom: 2rem">
        <h2
          style="
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
          "
        >
          Log Workout
        </h2>

        <form
          (ngSubmit)="submitWorkout()"
          style="display: flex; flex-direction: column; gap: 1.5rem"
        >
          <!-- Activity Type -->
          <div>
            <label class="label" for="activity_type">Activity Type</label>
            <select
              [(ngModel)]="workout.activity_type"
              name="activity_type"
              id="activity_type"
              class="select"
            >
              <option value="run">üèÉ Run</option>
              <option value="cycle">üö¥ Cycle</option>
              <option value="walk">üö∂ Walk</option>
            </select>
          </div>

          <!-- Duration -->
          <div>
            <label class="label" for="duration">Duration (minutes)</label>
            <input
              type="number"
              [(ngModel)]="workout.duration"
              name="duration"
              id="duration"
              required
              class="input"
              placeholder="30"
            />
          </div>

          <!-- Distance -->
          <div>
            <label class="label" for="distance">Distance (km)</label>
            <input
              type="number"
              step="0.1"
              [(ngModel)]="workout.distance"
              name="distance"
              id="distance"
              class="input"
              placeholder="5.0"
            />
          </div>

          <!-- Heart Rate Fields -->
          <div class="grid" style="grid-template-columns: 1fr 1fr">
            <div>
              <label class="label" for="heart_rate_avg">Avg Heart Rate (bpm)</label>
              <input
                type="number"
                [(ngModel)]="workout.heart_rate_avg"
                name="heart_rate_avg"
                id="heart_rate_avg"
                class="input"
                placeholder="150"
              />
            </div>
            <div>
              <label class="label" for="heart_rate_max">Max Heart Rate (bpm)</label>
              <input
                type="number"
                [(ngModel)]="workout.heart_rate_max"
                name="heart_rate_max"
                id="heart_rate_max"
                class="input"
                placeholder="180"
              />
            </div>
          </div>

          <!-- Intensity -->
          <div>
            <label class="label" for="intensity">Intensity</label>
            <select [(ngModel)]="workout.intensity" name="intensity" id="intensity" class="select">
              <option value="low">Low</option>
              <option value="moderate">Moderate</option>
              <option value="high">High</option>
            </select>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.75rem 1rem">
            üöÄ Log Workout
          </button>
        </form>
      </div>

      <!-- Results Panel -->
      <div style="display: flex; flex-direction: column; gap: 1.5rem">
        <!-- VO2 Max Results -->
        @if (workoutResult) {
        <div class="card" style="padding: 1.5rem">
          <h3
            style="
              font-size: 1.25rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
            "
          >
            <span style="margin-right: 0.5rem">üìä</span>
            Workout Results
          </h3>

          @if (workoutResult.error) {
          <div style="color: var(--error-color); font-size: 0.875rem">
            ‚ö†Ô∏è {{ workoutResult.error }}
          </div>
          } @else {
          <div style="display: flex; flex-direction: column; gap: 1rem">
            <div
              style="
                background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
                padding: 1rem;
                border-radius: var(--border-radius);
                border: 1px solid #bfdbfe;
              "
            >
              <div
                style="
                  font-size: 0.875rem;
                  color: var(--primary-color);
                  font-weight: 500;
                  margin-bottom: 0.25rem;
                "
              >
                Estimated VO2 Max
              </div>
              <div style="font-size: 1.875rem; font-weight: 700; color: #1e40af">
                {{
                  workoutResult.vo2max_estimate
                    ? (workoutResult.vo2max_estimate | number : '1.1-1')
                    : 'N/A'
                }}
                <span style="font-size: 1.125rem; color: var(--primary-color)">mL/kg/min</span>
              </div>
            </div>

            <div
              style="
                background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
                padding: 1rem;
                border-radius: var(--border-radius);
                border: 1px solid #bbf7d0;
              "
            >
              <div
                style="
                  font-size: 0.875rem;
                  color: var(--success-color);
                  font-weight: 500;
                  margin-bottom: 0.5rem;
                "
              >
                Health Benefits
              </div>
              <div style="color: #166534; font-size: 0.875rem; line-height: 1.4">
                {{ workoutResult.benefits }}
              </div>
            </div>
          </div>
          }
        </div>
        }

        <!-- API Status -->
        <div class="card" style="padding: 1.5rem">
          <h3
            style="
              font-size: 1.25rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
            "
          >
            <span style="margin-right: 0.5rem">üîó</span>
            System Status
          </h3>

          <div style="display: flex; flex-direction: column; gap: 0.75rem">
            <div
              class="status-indicator"
              [ngClass]="healthData ? 'status-success' : 'status-error'"
            >
              <div class="status-dot" [ngClass]="healthData ? 'success' : 'error'"></div>
              <span>{{
                healthData ? 'Backend API - Connected' : 'Backend API - Disconnected'
              }}</span>
            </div>

            <div
              class="status-indicator"
              [ngClass]="norseData ? 'status-connected' : 'status-error'"
            >
              <div class="status-dot" [ngClass]="norseData ? 'connected' : 'error'"></div>
              <span>{{ norseData ? 'Norse SNN - Active' : 'Norse SNN - Inactive' }}</span>
            </div>
          </div>
        </div>

        <!-- Workout Analytics Dashboard -->
        <div class="card" style="padding: 1.5rem">
          <h3
            style="
              font-size: 1.25rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 1.5rem;
              display: flex;
              align-items: center;
            "
          >
            <span style="margin-right: 0.5rem">üìä</span>
            Workout Analytics
          </h3>

          <div style="display: flex; flex-direction: column; gap: 2rem">
            <!-- VO2 Max Trend -->
            <div>
              <h4
                style="
                  font-size: 1rem;
                  font-weight: 600;
                  color: var(--text-primary);
                  margin-bottom: 1rem;
                "
              >
                VO2 Max Progress Over Time
              </h4>
              <ngx-charts-line-chart
                [view]="view"
                [scheme]="colorScheme"
                [results]="vo2MaxTrend"
                [gradient]="true"
                [xAxis]="true"
                [yAxis]="true"
                [legend]="false"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                xAxisLabel="Month"
                yAxisLabel="VO2 Max (mL/kg/min)"
              >
              </ngx-charts-line-chart>
            </div>

            <!-- Activity Distribution & Weekly Volume -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem">
              <!-- Activity Distribution -->
              <div>
                <h4
                  style="
                    font-size: 1rem;
                    font-weight: 600;
                    color: var(--text-primary);
                    margin-bottom: 1rem;
                  "
                >
                  Activity Distribution
                </h4>
                <ngx-charts-pie-chart
                  [view]="[300, 300]"
                  [scheme]="colorScheme"
                  [results]="activityDistribution"
                  [legend]="true"
                  [labels]="true"
                  [doughnut]="true"
                >
                </ngx-charts-pie-chart>
              </div>

              <!-- Weekly Volume -->
              <div>
                <h4
                  style="
                    font-size: 1rem;
                    font-weight: 600;
                    color: var(--text-primary);
                    margin-bottom: 1rem;
                  "
                >
                  Weekly Workout Volume (km)
                </h4>
                <ngx-charts-bar-vertical
                  [view]="[300, 300]"
                  [scheme]="colorScheme"
                  [results]="weeklyVolume"
                  [gradient]="true"
                  [xAxis]="true"
                  [yAxis]="true"
                  [legend]="false"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  xAxisLabel="Day"
                  yAxisLabel="Distance (km)"
                >
                </ngx-charts-bar-vertical>
              </div>
            </div>

            <!-- Heart Rate Zones -->
            <div>
              <h4
                style="
                  font-size: 1rem;
                  font-weight: 600;
                  color: var(--text-primary);
                  margin-bottom: 1rem;
                "
              >
                Heart Rate Zone Progress
              </h4>
              <ngx-charts-area-chart-stacked
                [view]="view"
                [scheme]="colorScheme"
                [results]="heartRateZones"
                [gradient]="true"
                [xAxis]="true"
                [yAxis]="true"
                [legend]="true"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                xAxisLabel="Week"
                yAxisLabel="Heart Rate (bpm)"
              >
              </ngx-charts-area-chart-stacked>
            </div>
          </div>
        </div>

        <!-- Feature Highlights -->
        <div class="card" style="padding: 1.5rem">
          <h3
            style="
              font-size: 1.25rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
            "
          >
            <span style="margin-right: 0.5rem">‚ö°</span>
            AI-Powered Features
          </h3>

          <div style="display: flex; flex-direction: column; gap: 0.75rem">
            <div class="feature-card">
              <div class="feature-icon gradient-blue">
                <span>üß†</span>
              </div>
              <div>
                <div style="font-weight: 500; color: var(--text-primary); margin-bottom: 0.25rem">
                  Spiking Neural Networks
                </div>
                <div style="font-size: 0.875rem; color: var(--text-secondary)">
                  Advanced temporal analysis for accurate VO2 max predictions
                </div>
              </div>
            </div>

            <div class="feature-card">
              <div class="feature-icon gradient-green">
                <span>üóÑÔ∏è</span>
              </div>
              <div>
                <div style="font-weight: 500; color: var(--text-primary); margin-bottom: 0.25rem">
                  Vector Database
                </div>
                <div style="font-size: 0.875rem; color: var(--text-secondary)">
                  ChromaDB for efficient fitness data storage and retrieval
                </div>
              </div>
            </div>

            <div class="feature-card">
              <div class="feature-icon gradient-purple">
                <span>üîå</span>
              </div>
              <div>
                <div style="font-weight: 500; color: var(--text-primary); margin-bottom: 0.25rem">
                  MCP Integration
                </div>
                <div style="font-size: 0.875rem; color: var(--text-secondary)">
                  External AI tools for enhanced fitness insights
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</main>
